---
layout: post
title: 微信小程序之技术如何服务于商业
tags: [WeChat, 小程序, 商业, 技术]
published: False
---

## 前言

![初代 iPhone 发布时间](http://7xjbdq.com1.z0.glb.clouddn.com/images/2016/1484030180588.png)

微信小程序已经在昨天（2017/01/09）正式发布，张小龙以发布日期的方式致敬了乔布斯的 iPhone（2007/01/09），其野心不可谓不大。

下面我将会尝试从商业和技术这两个角度来谈谈微信小程序。也许作为程序猿的我们会在技术架构上**看不起小程序**，不就是模仿了 Vue 的语法和 ReactNative（& Hybrid）的原理吗？也可能会因为其封闭性而**批判小程序**，破坏了万维网 Web 本来的开放性和去中心化；更加会由于其诸多限制而**抱怨小程序**，有限的官方 API 和打包程序大小让开发者感到捉襟见肘。

但要是我们明白了微信小程序的背后是如何承载着腾讯的商业愿景，便会明白一个道理，即「**技术永远是服务于商业的**」。很多时候某些功能不是在技术上无法实现（可不要小瞧了 BAT 所招聘的开发者们），而是在商业和产品的背景下，有目的性、有策略化地刻意而为之。

## 商业

### 微信小程序是什么？

极客公园前 CEO 阿禅在《[小程序想要什么？](https://kenengba.com/post/3538.html)》这篇文章中提到，一句话总结张小龙对小程序的定义：**小程序希望用即用即走的方式激活线下的弱连接场景。**

![微信·公众平台](http://7xjbdq.com1.z0.glb.clouddn.com/images/2016/1484051181209.png)

微信公众平台以「订阅号」起家，进而开创了「服务号」和「企业号」，当然还有「微信·开放平台」用于提供微信登录、微信支付等典型性 SDK。到了今天，小程序横空出世，其实我们可以把它当做是「服务号」的一种升级，首先从各种限制上来看，服务号本身的推送能力就特别弱（每月 4 次），而小程序的推送能力则几乎为零，只能被动地通知用户；其次便是小程序在功能型属性上的升级，扫描二维码即可开始使用，而不用「先关注在选择菜单」才能够进入 H5 页面，其目的也就在于解决服务号的体验不佳。

### 腾讯为何推出小程序？

![Facebook 太阳能无人飞机 Aquila](http://7xjbdq.com1.z0.glb.clouddn.com/images/2016/1484051363573.png)

在这个世界的另一端，另外一个社交巨头 Facebook 有着自己的[三大创新支柱](http://www.geekpark.net/topics/216488)：

1. **连接**，是让世界上尚未与互联网连通的 40 亿人（也是全球人口的大多数）也能上网。
2. **人工智能**，就是解决某些比如信息过载这样的核心问题，并建造真正智能的电脑系统。
3. **虚拟现实和增强现实**，就是建造下一代的电脑系统，让我们可以与对方共处一室，哪怕实际上远隔万里。

如同 Facebook 的愿景一样，「连接一切」也是微信以及腾讯的野心。IoT 物联网跟 AR/VR 被视为继移动互联网之后又一个新的商业争夺点，都在尝试着建立起「万物互联」的未来世界。但是未来还“未来”，世界上仍然有很多物品还没有被智能化，而依赖于图像识别技术的 AR 设备也还远远达不到精准识别物理世界的物品的程度，那么二维码也就成为了现实世界和网络世界之间一种折中的连接方案。

最后，从张小龙[所描述的未来场景](http://www.geekpark.net/topics/217652)中我们可以进一步理解微信的意图：“智能手机之后的平台，有可能是眼镜这样的设备，而在眼镜这个系统里，不用安装程序，眼镜看到哪里，应用程序就在哪里。比如眼镜看到灯的时候，灯的上方就会出现一个开关，扫到公园门口，就会出现门票系统。「这种程序应该是无处不在，但又可以随时访问。」”

### 适合什么样的应用场景？

![](http://7xjbdq.com1.z0.glb.clouddn.com/images/2016/1484051459393.png)

> 二维码背后是微信「连接一切」的野心，这样的决策也直接导致小程序第一批大量流量将来自于线下企业的导流。

先让我们来看看张小龙所畅想的小程序的实际例子：

- 用户到达线下某个餐馆就餐时，不需要下载这个餐馆的 APP，只需要在餐馆扫一下它的二维码，然后就可以在这个餐馆的小程序里排队或者点餐。
- 在公交车站，你扫一下公交站牌的二维码就可以了解下一辆公交车到站的时间。
- 在汽车站，扫一下汽车站的二维码就可以购买车票，而不需要排长队。

从上述例子上来说，张小龙对小程序的定位明显是一个「工具型」的产品，如何建立最短路径然后帮助用户直达产品功能就是一个「好的工具」。从在这一点上来看，目前已经上架的「滴滴出行」小程序就是一个最好的范例，打开小程序就能直接获取用户当前位置作为起点，然后用户输入终点之后就能开始呼叫用车，一气呵成。

### 回过头来看「微信的克制」

其实想清楚了 vision 层面的 strategy，才能够更明白微信为什么要如此限制。

比如说微信严格限制了小程序的线上导流、小程序的提醒也只能以「服务通知」的方式被动出现在聊天列表中，要的就是减少对用户的打扰，用完即走。目前来说，**用户只能通过扫码、搜索和微信群这三种方式打开小程序**，无法被分享到朋友圈，甚至无法通过朋友圈或者网页中的图片长按二维码进入。 

**这些限制条件在我们看来之所以是限制，其实是因为我们是站在互联网公司的角度来看待小程序。**而且现在大部分已上架的小程序都是由互联网公司所开发的，这和微信要「连接线下」的愿景有所矛盾，但又不得以而为之，必须由互联网公司先来带上一波，再慢慢渗透到 O2O 的线下商家当中去，这其中的机会和时运都还在酝酿当中。

有一句话说这么说的，[「短期不可高估，长期不可低估」](https://www.zhihu.com/question/54547736/answer/140056623)，其实这就很适用于目前来说对于小程序该有的态度。小程序的一切都在腾讯的掌控之下，你会发现哪怕是缺点，有可能只是微信有意而为之，而所谓的这些缺点，也是可以被腾讯一步一步调整和改进的。

![](http://7xjbdq.com1.z0.glb.clouddn.com/images/2016/1484051670988.png)

最后想说一点的是，在微信（[Weixin/Wechat Wide Web](https://zhuanlan.zhihu.com/p/24782839)）掌控之下的小程序所提供的服务对用户来说不见得是一件坏事儿，我们程序猿会从技术的角度批判它的封闭，违背了互联网/万维网的初衷。但是在另一方面，我相信一句话「人性本恶」，放任不管的互联网最终会变成一个烂摊子，看看现在的[网络暴力](https://zh.wikipedia.org/zh-hant/%E7%B6%B2%E8%B7%AF%E9%9C%B8%E5%87%8C)、[比特币市场](http://if.pedaily.cn/news/201701/20170106161298634.shtml)以及被调教的[微软聊天机器人 Tay](https://www.zhihu.com/question/41764875)。

## 技术

- 官方小程序
    - IDE
      - 下载安装：`brew cask install wechatwebdevtools
      - Appdata panel Appdata panel 用于显示当前项目当前时刻 appdata 具体数据，实时地反馈项目数据情况，可以在此处编辑数据，并及时地反馈到界面上。   [mp.weixin.qq.com]
      - 微信小程序运行在三端：iOS、Android 和 用于调试的开发者工具。 三端的脚本执行环境聚以及用于渲染非原生组件的环境是各不相同的： 在 iOS 上，小程序的 javascript 代码是运行在 JavaScriptCore 中，是由 WKWebView 来渲染的，环境有 iOS8、iOS9、iOS10 在 Android 上，小程序的 javascript 代码是通过 X5 JSCore来解析，是由 X5 基于 Mobile Chrome 37 内核来渲染的 在 开发工具上， 小程序的 javascript 代码是运行在 nwjs 中，是由 Chrome Webview 来渲染的   所以还是 WebView？ [mp.weixin.qq.com]
    - API
      - 数据绑定
        - 小程序中的数据绑定是单向的……   修改 data 会反馈到界面，但修改界面并不会反馈到数据里边。所以要获得输入框数据有两种办法，一种是通过 Form 组件的submit 事件取  e.detail.value ;另一种办法是单个组件手动加上 bindChange 事件，然后在事件函数中 用 this.setData( { key: e.detail.value } ) 去更新数据。=> Vue 的数据绑定和 Template 语法，React 的单向数据流。 [weibo.com]
      - 生命周期
        - 生命周期函数 onLoad: 页面加载  一个页面只会调用一次。 接收页面参数可以获取wx.navigateTo和wx.redirectTo及中的 query。 onShow: 页面显示  每次打开页面都会调用一次。 onReady: 页面初次渲染完成  一个页面只会调用一次，代表页面已经准备妥当，可以和视图层进行交互。 对界面的设置如wx.setNavigationBarTitle请在onReady之后设置。详见生命周期 onHide: 页面隐藏  当navigateTo或底部tab切换时调用。 onUnload: 页面卸载  当redirectTo或navigateBack的时候调用。   React：mount、update、unmount  Vue：mounted、 updated 、destroyed [mp.weixin.qq.com]
      - 模板 
        - WXML提供模板（template），可以在模板中定义代码片段，然后在不同的地方调用。 
        - 定义模板 使用name属性，作为模板的名字。然后在内定义代码片段，如：    [mp.weixin.qq.com]
      - 样式
        - rpx（responsive pixel）: 可以根据屏幕宽度进行自适应。  [mp.weixin.qq.com]
        - 样式导入 使用@import语句可以导入外联样式表，@import后跟需要导入的外联样式表的相对路径，用;表示语句结束。   [mp.weixin.qq.com]
      - 事件绑定
        - 在组件中绑定一个事件处理函数。  如bindtap，当用户点击该组件的时候会在该页面对应的Page中找到相应的事件处理函数。  Click me!   在相应的Page定义中写上相应的事件处理函数，参数是event。  Page({   tapName: function(event) {     console.log(event)   } })    [mp.weixin.qq.com]
- 第三方开发框架
    - 支持加载外部NPM包。在编译过程当中，会递归遍历代码中的require然后将对应依赖文件从node_modules当中拷贝出来，并且修改require为相对路径，从而实现对外部NPM包的支持。  [wepyjs.github.io]
    - wpy文件说明wpy文件的编译过程过下：  [zhuanlan.zhihu.com]
- 与其他方案的对比
    - PWA
    - ReactNative
    - Hybrid
- 相关资源：
    - [justjavac/awesome-wechat-weapp: 微信小程序开发资源汇总 :100:](https://github.com/justjavac/awesome-wechat-weapp)
    - [实例大全 - 微信小程序开发者](https://github.com/wxappdev)
